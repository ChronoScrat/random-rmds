---
title: "Uma an√°lise dos meus tweets"
author: "Nathanael Rolim"
date: "2023-03-20"
output: 
  html_notebook:
    code_folding: hide
editor_options: 
    chunk_output_type: inline
---

¬† ¬†

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning=FALSE,
                      message = FALSE,
                      error = FALSE)
Sys.setlocale("LC_TIME", "English")

# Libraries

library(data.table, quietly = TRUE)
library(dplyr, quietly = TRUE)
library(dtplyr, quietly = TRUE)
library(ggplot2, quietly = TRUE)
```

J√° faz um tempo que eu queria trabalhar em um projeto do R que envolvesse tweets. Honestamente, eu acho fascinante o n√∫mero de informa√ß√µes que uma rede de microblog limitada a 240 caracteres (n√£o mais!) pode trazer.

Infelizmente, acessar essa informa√ß√£o sempre foi um parto. O Twitter sempre teve um processo complicado para liberar o acesso ao API, e mesmo para seus pr√≥prios tweets, o usu√°rio est√° normalmente limitado aos √∫ltimos sete dias, caso ele n√£o tivesse um plano pago ou uma conta acad√™mica (eu jamais pagaria pelo twitter, e recusaram minha conta acad√™mica!).

A situa√ß√£o agora piorou com o E\*on Mu\*k anunciando que cobrar√° horrosos USD 400k para o acesso √† API do Twitter com capacidade de leitura. No entanto, gra√ßas as leis de prote√ß√£o de dados internacionais, uma alternativa - ao menos para os meus tweets - me restava: [uma c√≥pia de todos os meus dados](https://twitter.com/settings/download_your_data).

Essa √© uma solu√ß√£o bem mediana, na real, mas que abre um caminho de possibilidades. O arquivo final normalmente √© gerado em at√© 48 horas, mas diferente de um API, ele n√£o √© din√¢mico. Ainda assim, ele te tr√°s **muitas** informa√ß√µes, como: todos os seus tweets e tweets deletados, todos os seus likes, suas m√≠dias, suas conversas etc.

Como eu n√£o tinha nada melhor pra fazer com o meu tempo, apresento:

# An√°lise Mais In√∫til Poss√≠vel dos Meus Tweets

(Por favor, note: isso √© pouqu√≠ssimo reproduz√≠vel. O arquivo zipado que o Twitter gera tr√°s as informa√ß√µes em arquivos JavaScript, que eu converti manualmente para JSON. Al√©m disso, eu estou usando apenas uma sele√ß√£o destes arquivos para facilitar minha vida. Existe uma forma de fazer isso programaticamente, mas honestamente *I couldn't be bothered*.)

```{r tweet-data}
tweets <- jsonlite::read_json(path = "data/tweets.json", simplifyVector = TRUE)
tweets <- data.table::data.table(tweets) # Converte para data.table
tweets <- tweets %>%
  mutate(tweet.created_at = lubridate::as_datetime(tweet.created_at, format = "%a %b %d %H:%M:%S %z %Y"))
```

¬†

A primeira coisa que eu fiz foi importar meus tweets. Como eles est√£o em formato JSON, as coisas ficam um pouco complicadas devido a forma como R implementa listas e afins. A melhor forma de trablhar com esse volume de dados, assim, √© converter ele direto para uma `data.table`. Ela √© Otimizada¬Æ.

Tendo nossos tweets em m√£os, podemos finalmente come√ßar nossas an√°lises. A primeira coisa que eu posso fazer √© ver quantos tweets eu fiz nesse per√≠odo.

```{r variables-1}
n_tweets <- tweets %>% nrow()

# Um pouco de trabalho para o primeiro tweet

## Data
first_tweet_dt <- tweets %>%
  arrange(tweet.created_at) %>%
  select(tweet.created_at) %>% head(n = 1) %>%
  strtoi() %>%
  lubridate::as_datetime()

## ID
first_tweet_id <- tweets %>%
  arrange(tweet.created_at) %>%
  select(tweet.id_str) %>% head(n = 1) %>%
  as.character(.)

## ID

# E para o mais recente
## Data
latest_tweet_dt <- tweets %>%
  arrange(desc(tweet.created_at)) %>%
  select(tweet.created_at) %>% head(n = 1) %>%
  strtoi() %>%
  lubridate::as_datetime()

## ID
latest_tweet_id <- tweets %>%
  arrange(desc(tweet.created_at)) %>%
  select(tweet.id) %>% head(n = 1) %>%
  as.character(.)
```

¬†

Intankavelmente, eu postei `r format(n_tweets, big.mark=".")` tweets nesse per√≠odo todo. Meu primeiro tweet foi feito no dia `r format(first_tweet_dt, format = "%d/%m/%Y")`; o √∫ltimo tweet nessa base foi feito no dia `r format(latest_tweet_dt, format = "%d/%m/%Y")`. 

## Uau! Voc√™ n√£o cala a boca!

Tendo o hist√≥rico dos meus tweets, podemos finalmente come√ßar a entender algumas coisas interessantes sobre meu padr√£o de postagem. O mais tradicional de tudo √© a linha do tempo!

```{r timeline, out.width="200%"}
tmp1 <- tweets %>%
  mutate(tweet.created_at = lubridate::as_date(tweet.created_at)) %>%
  group_by(tweet.created_at) %>%
  summarise(num = n()) %>%
  arrange(tweet.created_at)

ggplot(data = tmp1, mapping = aes(x = tweet.created_at, y = num)) +
  geom_line()+
  scale_x_date(date_labels = "%b-%y", date_breaks = "6 months")+
  xlab("M√™s") + ylab("N√∫mero de Tweets") +
  labs(title = "N√∫mero de Tweets por Dia") +
  theme_minimal()
```

Mesmo sendo horroroso, esse gr√°fico apresenta uma tend√™ncia bem interessante: apesar de meu in√≠cio nessa rede social infernal ter ocorrido em novembro de 2016, eu subutilizei minha capacidade de reclamar at√© meados de 2019, quando eu finalmente comecei a me expressar mais nesse p√°ssaro maldito.

Alguns pontos s√£o interessantes:

1.  Em Fevereiro de 2018, eu comecei a cursar Rela√ß√µes Internacionais na USP. D√° pra se notar no gr√°fico que alguma atividade, mesmo que pequena, come√ßa a acontecer no per√≠odo.
2.  Em 2019, eu estava no meu segundo ano da faculdade. Esse ano foi marcado por algumas mat√©rias bem estressantes - em especial no segundo semestre. Foi tamb√©m o ano em que eu fui monitor de Estat√≠stica Aplicada. Basta dizer que n√£o foi uma experi√™ncia salubre.
3.  No come√ßo de 2020, a pandemia de Covid estourou. O isolamento social come√ßou e eu, assim como milhares de outras almas perdidas, comecei a usar mais intensamente o Twitter. Juntaram-se, nesse per√≠odo, reclama√ß√µes diversas, coment√°rio sobre a CPI da pandemia, an√°lise do BBB, live-tweeting de Amor de M√£e, entre outros!
4.  Por fim, 2022 foi o ano de "retorno" a normalidade, o que incluiu uma Copa do Mundo e uma Elei√ß√£o hist√≥rica.

Na verdade, a elei√ß√£o √© respons√°vel por esse pico imenso no gr√°fico. Meus r√©cordes em n√∫mero de tweets por dia s√£o: *02 de outubro de 2022*, dia do meu anivers√°rio e data do primeiro turno da elei√ß√£o pra presidente, com 116 tweets; e *30 de outubro de 2022*, data do segundo turno da elei√ß√£o, com intank√°veis **150 tuites**.

Quando observamos essa rela√ß√£o no agregado mensal, no entanto, isso muda um pouco:

```{r timeline-monthly, message=FALSE, warning=FALSE,}
tweets %>%
  mutate(tweet.created_at = lubridate::as_date(tweet.created_at),
         mes_ano = format(tweet.created_at, format = "%Y-%m-01"),
         mes_ano = lubridate::ymd(mes_ano)) %>%
  group_by(mes_ano) %>%
  summarise(num = n()) %>%
  arrange(mes_ano) %>%
  ggplot(data = ., mapping = aes(x = mes_ano, y = num)) +
  geom_bar(stat = "identity")+
  scale_x_date(date_labels = "%b-%y", date_breaks = "6 months")+
  scale_y_continuous(labels = scales::comma) +
  xlab("M√™s") + ylab("N√∫mero de Tweets") +
  labs(title = "N√∫mero de Tweets Agregado por M√™s") +
  theme_minimal()
```

¬†

Embora Outubro de 2022 ainda se destaque no n√∫mero de tweets, o principal destaque √© *Julho de 2021*. Eu n√£o me lembro o que aconteceu nesse per√≠odo. O terceiro lugar fica com *Abril de 2021*, m√™s do epis√≥dio final de **Amor de M√£e**, com um dos maiores live-tweetings da hist√≥ria!

Outro ponto interessant√≠ssimo (in√∫til) de se entender sobre meu padr√£o de postagem √© *quando* eu posto. Normalmente, se esperaria que meus tuintes estivessem concentrados fora do hor√°rio das 1h-7h, que √© quando estou dormindo, e mais presentes em dias de semana (porque √© quando eu mais reclamo).

```{r tweet-heatmap}
tweets %>%
  mutate(day_week = format(tweet.created_at, format = "%a"),
         hour = lubridate::hour(lubridate::with_tz(tweet.created_at, tz = "America/Sao_Paulo"))) %>%
  group_by(day_week,hour) %>%
  summarise(num = n()) %>% ungroup() %>%
  tidyr::complete(hour,day_week) %>%
  mutate(num = ifelse(is.na(num),0,num)) %>%
  ggplot(data = ., mapping = aes(x = day_week, y = hour, fill = num)) +
  geom_tile() +
  xlab("Dia da Semana") + ylab("Hora") +
  labs(title = "N√∫mero de Tweets por Hora e Dia da Semana") +
  scale_fill_viridis_c() +
  theme_minimal()
```

E no geral, √© poss√≠vel notar que eu estava certo! A maioria dos meus posts est√£o concentrados entre as 17h - 23h, que s√£o hor√°rios em que (1) eu estava estudando durante a pandemia, e (2) j√° estou em casa depois do trabalho. Um detalhe legal √© que Segunda, Ter√ßa e Quarta s√£o os principais dias de posts - convergindo com os PIORES dias que existem. Que curioso!

Por fim, uma coisa muito interessante de se avaliar √© o **tamanho** dos meus Tuintes. Durante a maior parte de sua exist√™ncia, o Twitter limitou seus posts a 180 caracteres, e somente em novembro de 2017 esse limite foi aumentado para o atual 240. Embora isso n√£o tenha [mudado muito o tamanho dos tweets](https://techcrunch.com/2018/10/30/twitters-doubling-of-character-count-from-140-to-280-had-little-impact-on-length-of-tweets/) de uma forma geral, aparentemente.

Mas como isso se manifesta nos meus tweets? Vamos ver:

```{r large-twintes}
tweets %>%
  tidyr::unnest(tweet.display_text_range) %>%
  filter(tweet.display_text_range != 0) %>%
  mutate(era = ifelse(lubridate::as_date(tweet.created_at) <= lubridate::ymd("2017-11-07"),"Limite Anterior","Limite Atual"),
         tweet.display_text_range = strtoi(tweet.display_text_range),
         cat = case_when(
           tweet.display_text_range < 30 ~ "< 30",
           (tweet.display_text_range >= 30) & (tweet.display_text_range < 50) ~ "[30;50[",
           (tweet.display_text_range >= 50) & (tweet.display_text_range < 100) ~ "[50;100[",
           (tweet.display_text_range >= 100) & (tweet.display_text_range < 150) ~ "[100;150[",
           (tweet.display_text_range >= 150) & (tweet.display_text_range < 180) ~ "[150;180[",
           (tweet.display_text_range >= 180) & (tweet.display_text_range < 210) ~ "[180;210[",
           (tweet.display_text_range >= 210) & (tweet.display_text_range < 240) ~ "[210;240[",
           tweet.display_text_range >= 240 ~ "240 >"
         ),
         cat = forcats::fct_relevel(cat,"< 30","[30;50[","[100;150[","[150;180[",
                                    "[180;210[","[210;240[","240 >")) %>%
  group_by(era, cat) %>%
  summarise(num = n()) %>%
  mutate(freq = num/sum(num)) %>%
  ggplot(data = ., mapping = aes(x = era, y = freq, fill = cat)) +
  geom_bar(position = "fill", stat = "identity") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Momento") + ylab("Porcentagem") +
  labs(title = "Tamanho m√©dio dos meus tweets") +
  theme_minimal()
```
√â importante notar que esses valores s√£o *aproximados*, porque infelizmente o Twitter adiciona na contagem oficial coisas como links, m√≠dia e men√ß√µes - que normalmente s√£o exclu√≠dos do limite de postagem.

Ainda assim √© poss√≠vel notar que a grande maioria dos meus posts t√™m entre 50 e 100 caracteres, e o aumento do limite n√£o mudou muito isso. Em geral, o aumento do segmento entre 100 e 150 est√° mais associado aos meus posts mais frequentes do que a uma mudan√ßa no tamanho em si.


Por fim, uma coisa interessante sobre o meu padr√£o de postagem √© entender o que n√£o √© post meu. Mais precisamente, √© interessante se entender quantos dos meus tweets s√£o, na verdade, retweets. E aqui est√° uma coisa interessante: quando n√≥s retuitamos algo, desconsiderando QRTs, o Twitter oficialmente grava isso com o seguinte texto `RT @[HANDLE]: [TEXTO]`. Assim, n√≥s conseguimos saber exatamente quanto dos meus posts se encaixam nesse crit√©rio:

```{r rts-and-qrts}
tweets %>%
  tidyr::unnest(tweet.entities.urls, keep_empty = TRUE) %>%
  mutate(rt_qrt = case_when(
    stringr::str_detect(tweet.full_text,"RT @") ~ "RT",
    !(stringr::str_detect(tweet.full_text,"RT @")) & !(is.na(url)) ~ "QRT",
    TRUE ~ "Normal"
  )) %>%
  group_by(rt_qrt) %>%
  summarise(num = n()) %>%
  mutate(freq = num/sum(num),
         ymax = cumsum(freq),
         ymin = c(0, head(ymax, n=-1)),
         labelPos = (ymax+ymin)/2) %>%
  ggplot(data = ., mapping = aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = rt_qrt)) +
  geom_rect() +
  geom_label( x=3.5, aes(y=labelPos, label=scales::percent(round(freq, digits = 3)))) +
  coord_polar(theta = "y") +
  xlim(c(2,4)) +
  theme_void() +
  labs(title = "Rela√ß√£o entre Tweets, RTs e QRTs") 


```


## Ay como interage!

Mas chega de falar sobre meus padr√µes de postagem. Est√° na hora de entender as verdadeiras quest√µes: com quem eu estou interagindo? Como meus seguidores est√£o interagindo comigo? Existe sentido nisso?

A primeira coisa que vamos averiguar √© quantas vezes meus tweets foram curtidos e retweetados. Com isso, poderemos ter uma taxa m√©dia de intera√ß√£o de outras pessoas com minhas publica√ß√µes.

```{r like-and-rt}
sum_likes <- sum(strtoi(tweets$tweet.favorite_count))
sum_rts <- sum(strtoi(tweets$tweet.retweet_count))

```

No geral, meus tweets recebem `r round(sum_likes/n_tweets, digits = 2)` likes e `r round(sum_rts/n_tweets, digits = 2)` Re-Tweets! √â interessante, no entanto, notar alguns pontos: em geral, likes s√£o bem mais comuns do que RTs; meu perfil √© privado, o que desabilita a possibilidade de RTs atrav√©s de formas comuns; e eu n√£o sou t√£o interessante assim.

Infelizmente, o data dump do Twitter n√£o apresenta as informa√ß√µes de quem curtiu seus tweets, e embora ele traga uma lista de todos os posts que voc√™ j√° curtiu (question√°vel, na verdade), ela somente tr√°s o ID do tweet, e n√£o o nome do usu√°rio. Sem o nome, precisar√≠amos do API, que est√° fora de cogita√ß√£o.

Mas uma medida de intera√ß√£o que podemos fazer √© entender com quem eu interajo atrav√©s das men√ß√µes. A forma mais simples √© simplesmente ver com quem eu mais converso:

```{r screen-name-mention}
tweets %>%
  tidyr::unnest(.,tweet.entities.user_mentions) %>%
  filter(!is.na(tweet.in_reply_to_screen_name)) %>% # Sem esse, inclui os RTs
  filter(screen_name != "NathanaelRolim") %>%
  group_by(screen_name) %>%
  summarise(num = n()) %>%
  mutate(freq = num/sum(num)) %>%
  arrange(desc(num)) %>%
  head(n = 10) %>%
  mutate(screen_name = paste0("@",screen_name)) %>%
  ggplot(data = ., aes(x = reorder(screen_name, freq), y = freq, label = scales::percent(round(freq, digits = 3)))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = scales::percent) +
  geom_text(nudge_y= -.01, color="white",) +
  coord_flip() +
  xlab("Perfil") + ylab("Porcentagem de Men√ß√µes") +
  labs(title = "De quem eu sou mais f√£ ‚ù§Ô∏è") +
  scale_fill_viridis_c() +
  theme_minimal()
```

Meu querid√≠ssimo amigo Juan √© o primeiro lugar disparado, com quase 20% de todas as minhas men√ß√µes! Isso com certeza me faz o maior f√£ do Juan neste planeta, possivelmente nesta gal√°xia toda. Em segundo lugar est√° meu amad√≠ssimo Balba, que ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà, ‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà. [Removido por decis√£o judicial]

Em terceir√≠ssimo lugar, meu grande amigo Andr√©, com quem eu compartilho meu √∫nico neur√¥nio restante e em quem eu deposito toda a minha esperan√ßa para o futuro. Um dia, eu confio, o Andr√© ir√° me sustentar e eu nunca mais precisarei fazer um esfor√ßo na vida.

Al√©m dessas intera√ß√µes com meus querid√≠ssimos amigos, no entanto, h√° outro tipo de intera√ß√£o que vale a pena mencionar: as intera√ß√µes comigo mesmo! Nesse caso, h√° dois tipos poss√≠veis de men√ß√µes: respostas a outros tweets meus - o que indica uma *thread* - e QRTs (normalmente eu me dou um QRT quando preciso retomar alguma coisa que eu disse h√° algum tempo e adicionar uma nova informa√ß√£o).

```{r me-myself-i}
n_myself <- tweets %>%
  filter(tweet.in_reply_to_screen_name == "NathanaelRolim") %>%
  nrow()
```

No geral, eu apenas conversei em thread comigo mesmo `r n_myself` vezes, um n√∫mero bem desapontante, se voc√™ me perguntar. Eu converso comigo em voz alta o tempo todo, como pode eu n√£o fazer isso mais vezes no Twitter?

E no geral √© isso. Com certeza tem mais algumas coisas que eu consigo extrair desses dados, mas estou com muita pregui√ßa.

Se voc√™ chegou at√© aqui: üëç